@using ACDecompileParser.Shared.Lib.Models
@using ACDecompileParser.Shared.Lib.Output.CSharp
@using ACDecompileParser.Shared.Lib.Services
@inject CSharpGroupProcessor CSharpProcessor
@inject ICommentProvider CommentProvider

<div class="code-view">
    @if (_cachedCSharpBindings == null)
    {
        <div class="p-4 text-gray-400 italic">
            Generating bindings and fetching comments...
        </div>
    }
    else
    {
        <pre><code class="language-csharp">@_cachedCSharpBindings</code></pre>
    }
</div>

@code {
    [Parameter] public List<TypeModel>? TypeGroup { get; set; }

    private string? _cachedCSharpBindings;
    private List<TypeModel>? _cachedTypeGroup;

    protected override async Task OnParametersSetAsync()
    {
        if (!ReferenceEquals(TypeGroup, _cachedTypeGroup))
        {
            _cachedTypeGroup = TypeGroup;
            _cachedCSharpBindings = null;

            if (TypeGroup != null && TypeGroup.Any())
            {
                // Populate comments from hallucinator before generating content
                await CSharpProcessor.PopulateCommentsAsync(TypeGroup, CommentProvider);
                _cachedCSharpBindings = CSharpProcessor.GenerateGroupContent(TypeGroup, includeNamespace: false);
            }
        }
    }

}
